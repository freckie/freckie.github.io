{"componentChunkName":"component---src-templates-blog-post-js","path":"/spring/spring-batch-5-metadata-db/","result":{"data":{"site":{"siteMetadata":{"title":"Freckie et al.","author":"Freckie","siteUrl":"https://blog.frec.kr","comment":{"disqusShortName":"","utterances":"freckie/freckie.github.io"},"sponsor":{"buyMeACoffeeId":"freckie"}}},"markdownRemark":{"id":"cf5d3ecb-405e-5260-a919-7390b1c7d808","excerpt":"스프링 배치 메타데이터 스프링 배치에서는 과 의 실행 상태, 파라미터, 컨텍스트 등을 관리하기 위해 메타데이터 테이블을 필요로 한다. 1 메타데이터 엔티티들은 , , ,  등이 있고, 이들을 관리하는 테이블들은 총 6개로 다음과 같다.  : Job이 실행될 때마다 생성된 JobInstance  : JobInstance의 시작/종료 시간, 상태, 종료 메세지 등 정보  : JobExecution에 전달되는 JobParameters  : Job 범위에서 관리하는 컨텍스트가 serialize…","html":"<h2 id=\"스프링-배치-메타데이터\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B0%B0%EC%B9%98-%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0\" aria-label=\"스프링 배치 메타데이터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링 배치 메타데이터</h2>\n<ul>\n<li>스프링 배치에서는 <code class=\"language-text\">Job</code>과 <code class=\"language-text\">Step</code>의 실행 상태, 파라미터, 컨텍스트 등을 관리하기 위해 메타데이터 테이블을 필요로 한다. [1]</li>\n<li>\n<p>메타데이터 엔티티들은 <code class=\"language-text\">JobInstance</code>, <code class=\"language-text\">JobExecution</code>, <code class=\"language-text\">JobParameters</code>, <code class=\"language-text\">StepExecution</code> 등이 있고, 이들을 관리하는 테이블들은 총 6개로 다음과 같다.</p>\n<ul>\n<li><code class=\"language-text\">BATCH_JOB_INSTANCE</code> : Job이 실행될 때마다 생성된 JobInstance</li>\n<li><code class=\"language-text\">BATCH_JOB_EXECUTION</code> : JobInstance의 시작/종료 시간, 상태, 종료 메세지 등 정보</li>\n<li><code class=\"language-text\">BATCH_JOB_EXECUTION_PARAMS</code> : JobExecution에 전달되는 JobParameters</li>\n<li><code class=\"language-text\">BATCH_JOB_EXECUTION_CONTEXT</code> : Job 범위에서 관리하는 컨텍스트가 serialize되어 기록됨.</li>\n<li><code class=\"language-text\">BATCH_STEP_EXECUTION</code> : Job 하위 Step들의 시작/종료 시간, 상태, read/write/skip/commit 카운트 등 상세한 정보</li>\n<li><code class=\"language-text\">BATCH_STEP_EXECUTION_CONTEXT</code> : Step 범위에서 관리하는 컨텍스트가 serialize되어 기록됨.</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 831px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAACT0lEQVQoz4VTaW/TQBD1//8nQCUEAtSWAoW2aRNKnMTnem3vrm8nduw2vq8wcaV+IRGr0Wr9PO/N7Mws96iyz3eLi6nw5XZ+ORW+88jwt/v9fhiG/f8W57g2UlWsIYRUy7Lqum6b2ouz38heGN5MoSINT+lwiNhzEfGS9igoIia8gp1g7YSbq8mfn7PFr9lCNp3+BJt7PeV58XpOn59sRpipr3136Luu74+Td0X14WZ+9m0K9uZyciuYgLrBeilrc1HhRUXG5gu57wdI4bC/2DBwVdMYlKqqZphkvYnKqoJSVe2Q1V38lD3lVQYfp+5cN43jupQQ0zSDMKzrBtA5Ym+/Ppxd3b+7nJxPxabrg3h3tzKmkjlZ4fsVvlthFm65pm1t1yXjatt27NAQRxvDMEDQ87w8z0DO8jfX0wWU8HrKAxG7UZjsRrLjMEoxxlEU9X3fdt0mjimlkAs0DxS7rnvOdq5jhb7r2Ax6CXIAck3TABmcNE1br9cAlWUJZMYYyMVxDH5VVW2ThFkWKPpB8HJhCHOIzGybjUvX9TRN4UeSJhajkA5knqYJINs0hTECB9uymrouirwsiwPZsm168KQmIclIZo63FJWFIPOCJCEMmYdxImpEwnQ0slQMywsOZD/wGSWUmI5td2PN8rKGJgVREj/nyS7vTw1JUZYy0peSuoBQokIth/jxxxv+/EF4/+P3p1v+YibNkH2cDNOTZmWaV2BJVu6KepsmkqoqKkJYVzW8y4uqaY8+Mu5faBNvVzISZBV2WdNVneiEHY38F+2HdOuc9sscAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20230526 1\"\n        title=\"20230526 1\"\n        src=\"/static/51ef1ae3594608675717babc0d7d96ad/5b4a1/20230526-1.png\"\n        srcset=\"/static/51ef1ae3594608675717babc0d7d96ad/5a46d/20230526-1.png 300w,\n/static/51ef1ae3594608675717babc0d7d96ad/0a47e/20230526-1.png 600w,\n/static/51ef1ae3594608675717babc0d7d96ad/5b4a1/20230526-1.png 831w\"\n        sizes=\"(max-width: 831px) 100vw, 831px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>(이미지 출처 : <a href=\"https://docs.spring.io/spring-batch/docs/current/reference/html/schema-appendix.html\">https://docs.spring.io/spring-batch/docs/current/reference/html/schema-appendix.html</a>)</p>\n<br>\n<p><strong>문제 상황</strong></p>\n<ul>\n<li>배치 Job에서 사용하는 서비스 DB에 배치 메타데이터 테이블이 위치하는 것이 바람직하지 않을 수 있다.</li>\n<li>\n<p>혹은 비주류 DB에 메타데이터를 저장하려 할 경우, 스프링 배치에서 지원하지 않을 수 있다. [2] (ex. Tibero)</p>\n<ul>\n<li>지원하는 DB: DB2, Derby, H2, HANA, HSQL, MariaDB, MySQL, Postgres, Sqlite, SqlServer, Sybase</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"메타데이터-db-분리하기-spring-batch-50-이전\" style=\"position:relative;\"><a href=\"#%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0-db-%EB%B6%84%EB%A6%AC%ED%95%98%EA%B8%B0-spring-batch-50-%EC%9D%B4%EC%A0%84\" aria-label=\"메타데이터 db 분리하기 spring batch 50 이전 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메타데이터 DB 분리하기 (Spring Batch 5.0 이전)</h2>\n<p>웹에서 찾아보면 주로 다음 솔루션이 보인다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">DefaultBatchConfigurer</code>를 구현하고 DataSource를 설정하는 부분을 비워두는 방법</p>\n<ul>\n<li>ex) <a href=\"https://stackoverflow.com/a/42677607\">https://stackoverflow.com/a/42677607</a></li>\n<li>\n<p>DataSource가 설정되지 않을 때, 스프링 배치는 <code class=\"language-text\">MapJobRepositoryFactoryBean</code>을 이용해 메타데이터를 <strong>Map 기반으로 인메모리 관리</strong>한다.</p>\n<ul>\n<li>이 경우 Thread-safe하지 않아 Job을 병렬로 구동할 경우 문제가 발생할 수 있으며,</li>\n<li>퍼포먼스 또한 형편없어서 deprecated 처리되었다. [3]</li>\n</ul>\n</li>\n<li>\n<p>또한 Spring Batch 5.0에서는 DefaultBatchConfigurer가 제거되어 이 방법을 사용할 수 없는데,</p>\n<ul>\n<li>대체로 생긴 DefaultBatchConfiguration은 DataSource 설정을 지원하지 않는다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"spring-batch-50에서\" style=\"position:relative;\"><a href=\"#spring-batch-50%EC%97%90%EC%84%9C\" aria-label=\"spring batch 50에서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring Batch 5.0에서</h2>\n<ul>\n<li>\n<p><code class=\"language-text\">@EnableBatchProcessing</code> 어노테이션은 5.0 버전에서 몇가지 변경점이 있다.</p>\n<ul>\n<li>dataSourceRef 속성을 통해 DataSource 빈을 직접 지정해줄 수 있고,</li>\n<li>transactionManagerRef 속성을 통해 TransactionManager 빈을 직접 지정할 수 있다.</li>\n</ul>\n</li>\n<li>\n<p>Configuration에서 DataSource 빈을 두 개 등록해주고 서비스 데이터가 들어갈 데이터소스에 <code class=\"language-text\">@Primary</code> 어노테이션을 설정해두었다.</p>\n<ul>\n<li>다음 BatchConfig.java 코드와 같이 batch 메타데이터가 저장될 데이터소스(batchDataSource)를 따로 생성하였다.</li>\n</ul>\n</li>\n<li>\n<p>TransactionManager 빈을 등록할 때 사용할 데이터소스를 지정해주었으며,</p>\n<ul>\n<li>최종적으로 JobConfig에서 <code class=\"language-text\">@EnableBatchProcessing(dataSourceRef = &quot;batchDataSource&quot;, transactionManagerRef = &quot;jpaTransactionManager&quot;)</code> 어노테이션을 통해 두 데이터소스를 분리 지정했다.</li>\n</ul>\n</li>\n<li>추가로, batchDataSource 빈을 <code class=\"language-text\">EmbeddedDataSource</code>로 구성하여 H2와 같은 인메모리 DB를 사용할 수 있다.</li>\n</ul>\n<p>전체 코드는 다음과 같다.</p>\n<p><code class=\"language-text\">config/BatchConfig.java</code></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BatchConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.datasource.url}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> url<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.datasource.username}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.datasource.password}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.datasource.driver-class-name}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> driverClassName<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.datasource-batch.url}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> batchUrl<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.datasource-batch.username}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> batchUsername<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.datasource-batch.password}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> batchPassword<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.datasource-batch.driver-class-name}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> batchDriverClassName<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token annotation punctuation\">@Primary</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DataSource</span> <span class=\"token function\">dataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">DataSourceBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">username</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">driverClassName</span><span class=\"token punctuation\">(</span>driverClassName<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DataSource</span> <span class=\"token function\">batchDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">DataSourceBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>batchUrl<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">username</span><span class=\"token punctuation\">(</span>batchUsername<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span>batchPassword<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">driverClassName</span><span class=\"token punctuation\">(</span>batchDriverClassName<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PlatformTransactionManager</span> <span class=\"token function\">jpaTransactionManager</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EntityManagerFactory</span> entityManagerFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">JpaTransactionManager</span> jpaTransactionManager <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JpaTransactionManager</span><span class=\"token punctuation\">(</span>entityManagerFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        jpaTransactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">setDataSource</span><span class=\"token punctuation\">(</span><span class=\"token function\">dataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> jpaTransactionManager<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">JobConfig</code></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token annotation punctuation\">@EnableBatchProcessing</span><span class=\"token punctuation\">(</span>dataSourceRef <span class=\"token operator\">=</span> <span class=\"token string\">\"batchDataSource\"</span><span class=\"token punctuation\">,</span> transactionManagerRef <span class=\"token operator\">=</span> <span class=\"token string\">\"jpaTransactionManager\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DailyAggregationJobConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> jobName <span class=\"token operator\">=</span> <span class=\"token string\">\"dailyAggregationJob\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">JobRepository</span> jobRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PlatformTransactionManager</span> jpaTransactionManager<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">EntityManagerFactory</span> entityManagerFactory<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span>jobName<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Job</span> <span class=\"token function\">dailyAggregationJob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JobBuilder</span><span class=\"token punctuation\">(</span>jobName<span class=\"token punctuation\">,</span> jobRepository<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token function\">dailyAggregationStep1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n\t\t<span class=\"token annotation punctuation\">@JobScope</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">dailyAggregationStep1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StepBuilder</span><span class=\"token punctuation\">(</span>jobName <span class=\"token operator\">+</span> <span class=\"token string\">\"Step1\"</span><span class=\"token punctuation\">,</span> jobRepository<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DailyAggregationVo</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">DailyAggregatedData</span><span class=\"token punctuation\">></span></span><span class=\"token function\">chunk</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> jpaTransactionManager<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">reader</span><span class=\"token punctuation\">(</span><span class=\"token function\">dailyAggregationItemReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">processor</span><span class=\"token punctuation\">(</span><span class=\"token function\">dailyAggregationItemProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">writer</span><span class=\"token punctuation\">(</span><span class=\"token function\">dailyAggregationItemWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n\t\t<span class=\"token annotation punctuation\">@StepScope</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DailyAggregationItemReader</span> <span class=\"token function\">dailyAggregationItemReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DailyAggregationItemReader</span><span class=\"token punctuation\">(</span>entityManagerFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n\t\t<span class=\"token annotation punctuation\">@StepScope</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DailyAggregationItemReader</span> <span class=\"token function\">dailyAggregationItemProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DailyAggregationItemReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n\t\t<span class=\"token annotation punctuation\">@StepScope</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DailyAggregationItemReader</span> <span class=\"token function\">dailyAggregationItemWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DailyAggregationItemReader</span><span class=\"token punctuation\">(</span>entityManagerFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">resources/application.yaml</code></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">spring<span class=\"token operator\">:</span>\n\t<span class=\"token comment\">// ...</span>\n  datasource<span class=\"token operator\">:</span>\n    driver<span class=\"token operator\">-</span><span class=\"token keyword\">class</span><span class=\"token operator\">-</span>name<span class=\"token operator\">:</span> <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>mariadb<span class=\"token punctuation\">.</span>jdbc<span class=\"token punctuation\">.</span></span>Driver</span>\n    url<span class=\"token operator\">:</span> jdbc<span class=\"token operator\">:</span>mariadb<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">:</span><span class=\"token number\">20000</span><span class=\"token operator\">/</span>playground<span class=\"token operator\">?</span>characterEncoding<span class=\"token operator\">=</span>UTF<span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token operator\">&amp;</span>serverTimezone<span class=\"token operator\">=</span><span class=\"token class-name\">Asia</span><span class=\"token operator\">/</span><span class=\"token class-name\">Seoul</span>\n    username<span class=\"token operator\">:</span> username\n    password<span class=\"token operator\">:</span> password\n  datasource<span class=\"token operator\">-</span>batch<span class=\"token operator\">:</span>\n    driver<span class=\"token operator\">-</span><span class=\"token keyword\">class</span><span class=\"token operator\">-</span>name<span class=\"token operator\">:</span> <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>mariadb<span class=\"token punctuation\">.</span>jdbc<span class=\"token punctuation\">.</span></span>Driver</span>\n    url<span class=\"token operator\">:</span> jdbc<span class=\"token operator\">:</span>mariadb<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">:</span><span class=\"token number\">20001</span><span class=\"token operator\">/</span>batch_metadata<span class=\"token operator\">?</span>characterEncoding<span class=\"token operator\">=</span>UTF<span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token operator\">&amp;</span>serverTimezone<span class=\"token operator\">=</span><span class=\"token class-name\">Asia</span><span class=\"token operator\">/</span><span class=\"token class-name\">Seoul</span>\n    username<span class=\"token operator\">:</span> username\n    password<span class=\"token operator\">:</span> password\n\t<span class=\"token comment\">// ...</span></code></pre></div>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h2>\n<ul>\n<li>[1] <a href=\"https://docs.spring.io/spring-batch/docs/current/reference/html/schema-appendix.html\">https://docs.spring.io/spring-batch/docs/current/reference/html/schema-appendix.html</a></li>\n<li>[2] org.springframework.batch.support.DatabaseType (<a href=\"https://docs.spring.io/spring-batch/docs/current/api/org/springframework/batch/support/DatabaseType.html\">https://docs.spring.io/spring-batch/docs/current/api/org/springframework/batch/support/DatabaseType.html</a>)</li>\n<li>[3] <a href=\"https://github.com/spring-projects/spring-batch/issues/3780\">https://github.com/spring-projects/spring-batch/issues/3780</a></li>\n</ul>","frontmatter":{"title":"Spring Batch 5.0에서 배치용 메타데이터 DB와 서비스 DB 분리하기","date":"2023년 05월 26일 작성","series":null}}},"pageContext":{"slug":"/spring/spring-batch-5-metadata-db/","previous":{"fields":{"slug":"/troubleshooting/py_shm_unlink/"},"frontmatter":{"title":"파이썬 SharedMemory 사용 시 자동으로 unlink가 호출되는 문제","category":"Troubleshooting","draft":false}},"next":{"fields":{"slug":"/troubleshooting/ingress_nginx_regex/"},"frontmatter":{"title":"Ingress에 정의된 path에 regex 사용시 라우팅되지 않던 이슈","category":"Troubleshooting","draft":false}}}},"staticQueryHashes":["3128451518","521680639"]}