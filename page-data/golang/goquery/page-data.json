{"componentChunkName":"component---src-templates-blog-post-js","path":"/golang/goquery/","result":{"data":{"site":{"siteMetadata":{"title":"Fr3ky's Lab.","author":"Freckie","siteUrl":"https://blog.frec.kr","comment":{"disqusShortName":"","utterances":"freckie/freckie.github.io"},"sponsor":{"buyMeACoffeeId":"freckie"}}},"markdownRemark":{"id":"28702e15-376d-5045-9e2f-5c2a0abc90da","excerpt":"Tiobe 랭킹에 따르면 GoLang은 2020년 3월 기준으로 10위에 랭크되어있다. 많은 사용자가 있고 GoLang으로 작성된 프로젝트도 상당히 많아진만큼 괜찮은 언어임에는 이견이 없지만.. 사용에 있어서 언어 자체가 괜찮은 것과는 달리 큰 문제점이 있다. 바로 레퍼런스의 부족이다. 한글 문서의 부족은 말할 것도 없고, 심지어 영어 문서도 부족한 경우가 많다. 다만 GoLang…","html":"<p><a href=\"https://www.tiobe.com/tiobe-index/\">Tiobe 랭킹</a>에 따르면 GoLang은 2020년 3월 기준으로 10위에 랭크되어있다.</p>\n<p>많은 사용자가 있고 GoLang으로 작성된 프로젝트도 상당히 많아진만큼 괜찮은 언어임에는 이견이 없지만.. 사용에 있어서 언어 자체가 괜찮은 것과는 달리 큰 문제점이 있다.</p>\n<p><strong>바로 레퍼런스의 부족</strong>이다.</p>\n<p>한글 문서의 부족은 말할 것도 없고, 심지어 영어 문서도 부족한 경우가 많다.</p>\n<p>다만 GoLang이 중국에서는 꽤나 큰 인기를 얻는지 중문으로 된 글은 많지만 중국어와는 거리가 멀어 전혀 도움이 되지 않았다.</p>\n<p>(비교적 신생 언어라 이해는 하지만 ㅠㅠ)</p>\n<p>개인적으로 제일 많이 사용하는 언어라, 조금이나마 도움이 되고자 GoLang에 관련된 글을 많이 작성하려고 한다.</p>\n<h2 id=\"puerkitobiogoquery\" style=\"position:relative;\"><a href=\"#puerkitobiogoquery\" aria-label=\"puerkitobiogoquery permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PuerkitoBio/goquery</h2>\n<p>파이썬을 유저들 대부분은 <a href=\"https://www.crummy.com/software/BeautifulSoup/\">BeautifulSoup</a>을 이용해 웹 스크래핑, 크롤링 등을 진행해본 경험이 있을 것이다.</p>\n<p>간단히 기능에 대해 요약하자면, BeautifulSoup은 HTML이나 XML 소스를 파싱해 트리 형태로 만들어 순회하면서 데이터를 추출하는 용도의 라이브러리이다.</p>\n<p>파이썬의 BeautifulSoup만큼 압도적인 위상을 지니고 있는지는 모르겠지만 GoLang에도 HTML 파싱을 위한 <a href=\"https://github.com/PuerkitoBio/goquery\">goquery(링크)</a>라는 라이브러리가 있다.</p>\n<p><code class=\"language-text\">goquery</code>는 <code class=\"language-text\">net/http</code> 기본 라이브러리와 CSS Selector 라이브러리인 <a href=\"https://github.com/andybalholm/cascadia\">Cascadia</a> 를 기반으로 개발되었으며 jQuery와 문법 및 기능이 유사하게 개발되었다고 한다.</p>\n<p>다음 명령으로 설치하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ go get github.com/PuerkitoBio/goquery</code></pre></div>\n<p>(본 포스팅에서는 Go 1.13 버전과 goquery 1.5 버전(2018.11)을 기준으로 작성되었습니다.)</p>\n<h2 id=\"간단한-예제\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%98%88%EC%A0%9C\" aria-label=\"간단한 예제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간단한 예제</h2>\n<p>우선, 간단한 예제로 COVID-19 현황을 제공하는 정부 사이트의 현황판을 파싱해보았다.  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 489px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtklEQVQY0wGrAVT+AL26vL67vb26u+Lf4t7b3uLg4uDh5OTk6OLf5OTk6O7r8vbt9vXs9fbs9fXs9fHt9+zv+e3v+u3v+ers9gCYtuWUtOWTs+SVtOaVteaXtOKOoMiKnMaImsWMm8aQtNON1eOIz+CI0N+K0uOmytXCv8W+wMa8vsPO0NcAJHLhK3fiYJrrVZHnKHXkEl/SACqKI0maR2iqBSiHAVieALHHM77SOb/TDLfQLpOghnp4m5ydfn58pKWpADJ64TB54UGE4z+D4jJ741iP3zhZojxepVp3tDdTn0mKuR6+0Dq/00nE1hu50XCzvZOKiZKUlYKCgaqrrwA5f+FMjOVqnulgl+dcluiBqeRVca1CYqhNbK1PaKtunsNAyNg8v9NKxNcwv9SOwMiZkZCkp6iLioipqq4AKnXgO4HjQ4bkOn7iOoHlF2LSBTCNHUOVLFGfEjKNAFufALPJE7PLHrfNAK/LNJSiiX17i46OfXx7p6erAGKX5V6V5V+V5V+V5F+W51yP3UxrrUxprE9trU1lqUqLu0LE1UO+00a/0z7B1nCxvaeeoKGjppubnbu8wozOAEf+6EClAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20200320-1.png\"\n        title=\"20200320-1.png\"\n        src=\"/static/b6521ca52eeb2ff616465855ebfb93a6/03e1f/20200320-1.png\"\n        srcset=\"/static/b6521ca52eeb2ff616465855ebfb93a6/5a46d/20200320-1.png 300w,\n/static/b6521ca52eeb2ff616465855ebfb93a6/03e1f/20200320-1.png 489w\"\n        sizes=\"(max-width: 489px) 100vw, 489px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>(타겟 사이트 : <a href=\"http://ncov.mohw.go.kr/\">http://ncov.mohw.go.kr/</a>)</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n <span class=\"token string\">\"fmt\"</span>\n <span class=\"token string\">\"log\"</span>\n <span class=\"token string\">\"net/http\"</span>\n\n <span class=\"token string\">\"github.com/PuerkitoBio/goquery\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token comment\">// Request</span>\n url <span class=\"token operator\">:=</span> <span class=\"token string\">\"http://ncov.mohw.go.kr/\"</span>\n resp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n  log<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span>\n <span class=\"token keyword\">defer</span> resp<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n <span class=\"token comment\">// HTML 읽기</span>\n html<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> goquery<span class=\"token punctuation\">.</span><span class=\"token function\">NewDocumentFromReader</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n  log<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span>\n\n <span class=\"token comment\">// 현황판 파싱</span>\n wrapper <span class=\"token operator\">:=</span> html<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ul.liveNum\"</span><span class=\"token punctuation\">)</span>\n items <span class=\"token operator\">:=</span> wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"li\"</span><span class=\"token punctuation\">)</span>\n\n <span class=\"token comment\">// items 순회하면서 출력</span>\n items<span class=\"token punctuation\">.</span><span class=\"token function\">Each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>idx <span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> sel <span class=\"token operator\">*</span>goquery<span class=\"token punctuation\">.</span>Selection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  title <span class=\"token operator\">:=</span> sel<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"strong.tit\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  value <span class=\"token operator\">:=</span> sel<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"span.num\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  before <span class=\"token operator\">:=</span> sel<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"span.before\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">,</span> before<span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>아웃풋은 다음과 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 284px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.67605633802817%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVQY0z1Px27jMBTUZ2woqlKiWC0WNVJWsbOG4cue9v+/Jc8BEh4GMySmMDnP03t/HMcwDKRpetODjHG1zvphHEfvvNu2bZ6nfd+lUowxqeSyLJx1Cdjmeb7d7oBaX/Z9c85P0xRiCDF654TgQEII6xqFEAoClLTWvc2Q5/0Q1/g2hPB8Prf94IxeegNbYIjWWggZ1/X2+bcuC4QQxhgwy7Lker3CTmPMfhzTNIJknD8eD8h2zo7TssyzUrohZAnhfj+hHOOsKIo8zxN4izH2fQ+zpRDWWK0U1HWUSingHmZ3XVeVJUTALyil0Jl/n2ScZg/z3OBHZ60lbQcpOM//IPSRph8IpSlGOEU4Q98S/zjf5peRN81PzRfWuq59GQH8n9OnYncgw8XS5tD8/9gb2lwV6+rq15+A4KQWDQGkdSWbN15a0reE1xWrK1IWnFS6JaQqm7Isi9/i/AuRjVSDaInYNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20200320-2.png\"\n        title=\"20200320-2.png\"\n        src=\"/static/6c3a464d2112b1613bb555b8aa9ce4cb/62f93/20200320-2.png\"\n        srcset=\"/static/6c3a464d2112b1613bb555b8aa9ce4cb/62f93/20200320-2.png 284w\"\n        sizes=\"(max-width: 284px) 100vw, 284px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<h2 id=\"request\" style=\"position:relative;\"><a href=\"#request\" aria-label=\"request permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>request</h2>\n<p><code class=\"language-text\">net/http</code> 기본 패키지를 이용해서 request를 보냈다.</p>\n<p>만약 User-Agent 등의 헤더를 추가해 보내고 싶다면, 다음 방법을 이용하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token comment\">// Request</span>\nreq<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">NewRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n log<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\nreq<span class=\"token punctuation\">.</span>Header<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User-Agent\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Crawler\"</span><span class=\"token punctuation\">)</span>\n\nclient <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>http<span class=\"token punctuation\">.</span>Client<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nresp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Do</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n log<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">defer</span> resp<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"css-selector\" style=\"position:relative;\"><a href=\"#css-selector\" aria-label=\"css selector permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSS Selector</h2>\n<p><code class=\"language-text\">Find()</code> 함수에는 string으로 CSS Selector를 전달한다.</p>\n<p>다음은 CSS Selector의 몇가지 예시다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">ul</code></p>\n<ul>\n<li><code class=\"language-text\">&lt;ul&gt; ... &lt;/ul&gt;</code></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">ul.liveNum</code></p>\n<ul>\n<li><code class=\"language-text\">&lt;ul class=&quot;liveNum&quot;&gt; ... &lt;/ul&gt;</code></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">ul#id</code></p>\n<ul>\n<li><code class=\"language-text\">&lt;ul id=&quot;id&quot;&gt; ... &lt;/ul&gt;</code></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">li &gt; strong.tit</code></p>\n<ul>\n<li><code class=\"language-text\">&lt;li&gt; &lt;strong class=&quot;tit&quot;&gt; ... &lt;/strong&gt; &lt;/li&gt;</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"검색--find\" style=\"position:relative;\"><a href=\"#%EA%B2%80%EC%83%89--find\" aria-label=\"검색  find permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>검색 : Find()</h2>\n<p>파이썬의 BeautifulSoup에서는 find()와 find_all() 함수가 있었는데, 전자는 처음으로 발견된 검색 결과를 리턴하고 후자는 검색 결과를 리스트로 리턴했다.</p>\n<p>goquery에서 <code class=\"language-text\">Find()</code> 함수는 해당되는 노드를 전부 탐색하며, <code class=\"language-text\">*goquery.Selection</code> 구조체를 리턴한다.</p>\n<p>(자세한 정보는 <a href=\"https://godoc.org/github.com/PuerkitoBio/goquery#Selection\">godoc 문서</a>를 참조)</p>\n<p>이를 순회하기 위해서 <code class=\"language-text\">.Each()</code>를 사용한다.</p>\n<h2 id=\"노드-순회--each\" style=\"position:relative;\"><a href=\"#%EB%85%B8%EB%93%9C-%EC%88%9C%ED%9A%8C--each\" aria-label=\"노드 순회  each permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>노드 순회 : Each()</h2>\n<p><code class=\"language-text\">Each()</code>에는 파라미터로 <code class=\"language-text\">func(int, *goquery.Selection)</code>이 요구된다.</p>\n<p>노드를 순회하면서 파라미터로 들어온 함수를 실행하게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"검색된 결과 : %d개\\n\"</span><span class=\"token punctuation\">,</span> items<span class=\"token punctuation\">.</span><span class=\"token function\">Length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nitems<span class=\"token punctuation\">.</span><span class=\"token function\">Each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>idx <span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> sel <span class=\"token operator\">*</span>goquery<span class=\"token punctuation\">.</span>Selection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"현재 위치 :\"</span><span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span>\n fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"현재 태그 :\"</span><span class=\"token punctuation\">,</span> goquery<span class=\"token punctuation\">.</span><span class=\"token function\">NodeName</span><span class=\"token punctuation\">(</span>sel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>(<code class=\"language-text\">goquery.NodeName()</code> 함수는 해당 노드의 태그 이름을 리턴한다)</p>\n<h2 id=\"노드-순회--eachwithbreak\" style=\"position:relative;\"><a href=\"#%EB%85%B8%EB%93%9C-%EC%88%9C%ED%9A%8C--eachwithbreak\" aria-label=\"노드 순회  eachwithbreak permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>노드 순회 : EachWithBreak()</h2>\n<p>순회 방법에는 <code class=\"language-text\">Each()</code> 외에도 <code class=\"language-text\">EachWithBreak()</code>가 존재한다.</p>\n<p>특정 조건에서 순회를 멈추고 그 Selection을 전달받고 싶을 때 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">var</span> title <span class=\"token builtin\">string</span>\nitems<span class=\"token punctuation\">.</span><span class=\"token function\">Each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>idx <span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> sel <span class=\"token operator\">*</span>goquery<span class=\"token punctuation\">.</span>Selection<span class=\"token punctuation\">)</span> <span class=\"token builtin\">bool</span> <span class=\"token punctuation\">{</span>\n title <span class=\"token operator\">=</span> sel<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"strong.tit\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">if</span> title <span class=\"token operator\">==</span> <span class=\"token string\">\"치료 중(격리 중)\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n <span class=\"token punctuation\">}</span>\n <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"텍스트-추출\" style=\"position:relative;\"><a href=\"#%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%B6%94%EC%B6%9C\" aria-label=\"텍스트 추출 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>텍스트 추출</h2>\n<p>해당 태그 내의 모든 텍스트를 추출하려면 지금까지 자연스럽게 사용한 <code class=\"language-text\">.Text()</code> 함수를 호출하면 된다.</p>\n<p>만약, 해당 태그 내에서 바로 밑의 자손 텍스트만 출력하기 위해서는 다음과 같이 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">Contents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>idx <span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> sel <span class=\"token operator\">*</span>goquery<span class=\"token punctuation\">.</span>Selection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// Contents()는 바로 밑의 자손들</span>\n <span class=\"token keyword\">if</span> goquery<span class=\"token punctuation\">.</span><span class=\"token function\">NodeName</span><span class=\"token punctuation\">(</span>sel<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"#text\"</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 태그가 없는 단순 텍스트</span>\n  fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>sel<span class=\"token punctuation\">.</span><span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"속성-추출\" style=\"position:relative;\"><a href=\"#%EC%86%8D%EC%84%B1-%EC%B6%94%EC%B6%9C\" aria-label=\"속성 추출 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>속성 추출</h2>\n<p>태그의 속성을 추출할 때, 다음과 같이 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">aTag <span class=\"token operator\">:=</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span>\nhref<span class=\"token punctuation\">,</span> ok <span class=\"token operator\">:=</span> aTag<span class=\"token punctuation\">.</span><span class=\"token function\">Attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 속성값 추출</span>\n<span class=\"token keyword\">if</span> <span class=\"token operator\">!</span>ok <span class=\"token punctuation\">{</span>\n fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href 없음.\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>GoLang의 HTML 파싱 라이브러리인 <code class=\"language-text\">PuerkitoBio/goquery</code>에 대해 살펴보았다.</p>\n<p>경험상, 본 포스팅에 소개된 함수들만 이용해도 원하는 데이터를 추출하는데 큰 지장은 없던 것 같다.</p>","frontmatter":{"title":"goquery를 이용해서 html 파싱하기","date":"March 20, 2020"}}},"pageContext":{"slug":"/golang/goquery/","previous":{"fields":{"slug":"/golang/troubleshooting-0/"},"frontmatter":{"title":"missing Location in call to Time.In 에러","category":"GoLang","draft":false}},"next":{"fields":{"slug":"/networking/rpi-wired-router/"},"frontmatter":{"title":"Raspberry Pi as a Wired Router","category":"Networking","draft":false}}}},"staticQueryHashes":["3128451518","521680639"]}