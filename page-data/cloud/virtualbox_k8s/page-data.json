{"componentChunkName":"component---src-templates-blog-post-js","path":"/cloud/virtualbox_k8s/","result":{"data":{"site":{"siteMetadata":{"title":"Freckie's Lab.","author":"Freckie","siteUrl":"https://blog.frec.kr","comment":{"disqusShortName":"","utterances":"freckie/freckie.github.io"},"sponsor":{"buyMeACoffeeId":"freckie"}}},"markdownRemark":{"id":"8671821f-081f-52e6-afdd-ebc21e8012be","excerpt":"수정사항 2021.03.09 13:48 :: calico, flannel 설치 명령 오타 수정 2021.03.17 13:22 :: flannel 제외 환경 호스트 서버 Ubuntu 18.04 VirtualBox VirtualBox 가상머신 * 4ea vCPU 2ea, RAM 2GiB Ubuntu Server 20.04 VirtualBox 설치 VirtualBox로 가상머신 생성 VirtualBox를 켜고, 먼저 각 노드들이 연결될 가상 네트워크를 하나 생성할 것이다. VirtualBox…","html":"<p>수정사항</p>\n<ul>\n<li>2021.03.09 13:48 :: calico, flannel 설치 명령 오타 수정</li>\n<li>2021.03.17 13:22 :: flannel 제외</li>\n</ul>\n<h2 id=\"환경\" style=\"position:relative;\"><a href=\"#%ED%99%98%EA%B2%BD\" aria-label=\"환경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>환경</h2>\n<p><strong>호스트 서버</strong></p>\n<ul>\n<li>Ubuntu 18.04</li>\n<li>VirtualBox</li>\n</ul>\n<p><strong>VirtualBox 가상머신 * 4ea</strong></p>\n<ul>\n<li>vCPU 2ea, RAM 2GiB</li>\n<li>Ubuntu Server 20.04</li>\n</ul>\n<h2 id=\"virtualbox-설치\" style=\"position:relative;\"><a href=\"#virtualbox-%EC%84%A4%EC%B9%98\" aria-label=\"virtualbox 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VirtualBox 설치</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> -y virtualbox\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> -y virtualbox-ext-pack</code></pre></div>\n<h2 id=\"virtualbox로-가상머신-생성\" style=\"position:relative;\"><a href=\"#virtualbox%EB%A1%9C-%EA%B0%80%EC%83%81%EB%A8%B8%EC%8B%A0-%EC%83%9D%EC%84%B1\" aria-label=\"virtualbox로 가상머신 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VirtualBox로 가상머신 생성</h2>\n<p>VirtualBox를 켜고, 먼저 각 노드들이 연결될 가상 네트워크를 하나 생성할 것이다.</p>\n<p>VirtualBox 화면에서 상단 메뉴의 File > Preferences를 눌러 설정화면으로 들어가서 Networks 탭으로 들어간다. 우측의 네트워크 추가 버튼을 눌러 다음과 같이 설정한다. (10.0.0.0/8 대역은 사설 IP 대역이다.) </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 747px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQ4y32TaU8TQRzG93upEI9CavQVMfFA1E/hCxMjUaBSBTniK7+JMRI5Ss/tXbbntrvd++oBxSg8/mcqBvF48cszs7PzzP+YEW6Gr2IqdAXToQlMT00gdOMybt8K4fGju3g4ewdPSGfvz2COxg/ujZURnp7k/4eJ61OTmAtfwtOZaxCWFl4gGnmF6Osxy5GXWIku4f3GKt6tLGNz7S3WSNdXo+P5+go21t4gsjgPtjdCLCzMY3PxOT4sPoPg2gZqlSLKhSwqBRHVcp7GIkr5DHquidHAx1HPxVHfw4gYeBbnkL6dwdYHgYt+34dg6yokMknsbSOfjqMgpiCm9pHPJKHIdXTkJrqKTNqgeRM9nzYGHvpMz0OGvqVDYFHoSguZRAzFbBJZMk3EdlDKZVCXKiiViqhVqygX8ziolDEcDnA8OvqT4xEC14Lg2zr6lEIxm0IunSBNU5RJpOJ7kBtVNOo1KEqHDAvQNQ2npyc4+f4NX8mAmZzXwLUhOIbK02MRslRT+7vY2/6MNBm2mzUeJatpnkrRqB3weV0qw3dMStVBz7N/4VM/BNdUUc6LvCENqQSplP/VHLXd5JvFZIzDDt7Z+kSZxGHrCjxLg2d2Sc/QxikPA4cz8KmDvs3HrAyH1DVmGt/9wslSSVjz5LrE19le3zEQ/MSjucBPuYBrjk9zqRxWt40umbLGmTQ2VJmrpXU4bH62xg7gEV7Es5hqcCwDtm3BITRNhdIhc7UDlZrExqrShmkasEydq2v9xzAgQ83QIes2DK+HeCaLj1vbiIs57MRTRBJbuzFIrQ5MfwjN8SmAfxpqXF1Sy+jCJix6AB51kW0q0hWSDqj75RI67RaanSyydN1M+uevhudNg9++j2tcKeb4fa2W6W6qbbRkEQW6x+zV/QCAwceweViPywAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 1\"\n        title=\"20210308 1\"\n        src=\"/static/7d45450d79ab328ec4eeffe5e2b488df/d54e4/20210308-1.png\"\n        srcset=\"/static/7d45450d79ab328ec4eeffe5e2b488df/5a46d/20210308-1.png 300w,\n/static/7d45450d79ab328ec4eeffe5e2b488df/0a47e/20210308-1.png 600w,\n/static/7d45450d79ab328ec4eeffe5e2b488df/d54e4/20210308-1.png 747w\"\n        sizes=\"(max-width: 747px) 100vw, 747px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>이렇게 가상네트워크를 만들고 가상머신 생성을 시작한다. 이미지는 <a href=\"https://ubuntu.com/download/server\">우분투 20.04 서버 이미지</a>를 사용했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACl0lEQVQoz42Sy08TURTGb2KiC1cu/BPc6NbowmhcqYkCAgvLFIEaQR660EQjGggLNRg3bCQxGIPviBpfKPRJW6BQoKUPpEyfUGin7TClFRDczOeZaXFhQsLil+/MOTffOffcYbV1HGp1WrlGp0UNxdqqSlRzlaQVaGyoQ0vTJTQ36nCtpR4Nl2vAacoL9SJKrNGUy3Wa87jOla6xm2eOy21nT6Dt1FE84Ergczkx43Xjp9eFgN9DTGNWwTeNGU8hp9S2UHKR4Czi0aC8EA6AlTGGG4cPyrerdejQVoH3TsE1OQ735Bi8rgl4qIFrwgGfW4kn4J+mutOh1pV4cT6M5XRCXs9LWF0RZfa1uxv3e75B0/oU7d2faBoPrGY9Ru1DsFmMGLGaMWTSwzlqx4jNAsewFfYhI8ZGbGrsdNhhMxvUZqKwCNZ+twsf9ePo7TOg53k/TTIF40A/mRpgMQ6S2SCGrSbV1GIYgJXUpP9BfCdjEzW2wG4xkPEwpHQS7EJFE45wHXjZ+xnVjZ3weT20Qxe8dB0f4acd+WmnXvekmlP2q+QCP32Iz0cgZYQC6SUiDvaovASVzZ24dacL3JV7CPFzWIiGEAvzmI8EVeKxMC1+DtHQHBLxGCmPfFbEak5CLptBfkXCciqGTJIHa93L4Oh6CNubD+itv4psPEIHROSWBSL1j7xUICcKyNN3NpNANk1kkmq8IqaINFj9HoYnJw/hLVeGx6ePIRnlkZPSNP7W4e0QyEBQNatqIc/O7WbQ7mMo3cVw8cB+JKJBuk6m2FXYnqLB/3k28PoZzO9fwfTuBexf+iAm48XOyR1MmKLdJZT/UFX1lf9srGHz9yo2STfWf+3QLFl4WdoZHwohwPP0mAGklhbwF7nACup1iIphAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 2\"\n        title=\"20210308 2\"\n        src=\"/static/8671a5700e30b625dde2600082d541ff/c1b63/20210308-2.png\"\n        srcset=\"/static/8671a5700e30b625dde2600082d541ff/5a46d/20210308-2.png 300w,\n/static/8671a5700e30b625dde2600082d541ff/0a47e/20210308-2.png 600w,\n/static/8671a5700e30b625dde2600082d541ff/c1b63/20210308-2.png 1200w,\n/static/8671a5700e30b625dde2600082d541ff/6c2de/20210308-2.png 1334w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACbUlEQVQoz3WSSUxTURSGb+LGxJUrF8a1O7eaGHTjkAgLh4WSoNFg2tgItGFqsahA1ehCmmhCXKgbjGJMqhAXaoIk0HlChta2r7wWaOG1b2gLHaPv974nKCouvvz3npz7n5NzDzFc13xv0V5Bq+6q3HKtGe16Hbo6WtHd2QazqQMDfWbcvmnCnf5eWPrNMPd0wNilh6nbAFPXL2RFH5javhGrpgma/Xvk9gP7oN27EzbrPczNz2A24MGXgBdelx1BrwvTfg88zikk4hFUi3mU8iLKa9JW5IKUBbGcqpMvEoLeE0dlg7YHtuFXCM0G4Hc7EPA44KOGPrddPSuo5j43LeZRc4JeJwJep6zkpJKMTKz1h9HXdAn3/TJ048BoQMS0cxwuxxQckxNUJ+H3ONVOFfVREzeNbXbPRMNYYhmkFlkUciLIk8bTePYxiM4QcOF1DWNBCSlmBuHQHJIJFtVKGbVqGZVSEZXyFrbca7UKJJ5D4msQZOj8GYyM2fFYBC5Pyng7xyMR8iM8PwsmFkGSjSO1vKhWz0vCP+TELIrFdYSDdky8ew7yqKEOt042YDSSx9MM4EgK4BJRrCwn6UwWsMjGkF5iIWVXIGYo2W3IpJETOBRoAfLw7DHodxEYDx6CsVGLz+8/oFQQVIO8sErhkONX1UfSNqjxDVMxkwIx1h/BuR0EzbsJjtPfHrbcQLVaBL+ytJH0+9HfbBcnn968wMvBu7ANDWKE7uD01DhtnYfApf4w3ESJ8xSB+2mmKM+lVVUgRbqUlfI6yqU1VQs5HuJ/zBQDJhJCJDxPFzxG55ZFPM4gHI2CXYjRecfxA2vN2HOsYMSuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 3\"\n        title=\"20210308 3\"\n        src=\"/static/7ac8c6bc11869915592ab03f3b0b7b8c/c1b63/20210308-3.png\"\n        srcset=\"/static/7ac8c6bc11869915592ab03f3b0b7b8c/5a46d/20210308-3.png 300w,\n/static/7ac8c6bc11869915592ab03f3b0b7b8c/0a47e/20210308-3.png 600w,\n/static/7ac8c6bc11869915592ab03f3b0b7b8c/c1b63/20210308-3.png 1200w,\n/static/7ac8c6bc11869915592ab03f3b0b7b8c/c1bea/20210308-3.png 1388w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>쿠버네티스 노드는 메모리가 2GB 이상으로 설정되어야 한다고 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLklEQVQoz42SS0hUURjHD7QJWrVqEa3btS0Ia9MD0kWPRQgWiDGSlA/UHFOTYlRqkUKBtKhVElJiJEEUuElp8NE4XmfuncfVoXk4M/d6x8ZXUt1f515bWGS1+PF9cM75n///nE80XPN8v15dSW3NFbv2ahWN9TW0NNXR0lxH+80mfHc6JO10+27R09VJR1sz3hv1tLY0bMd26r3Wum+iz1OB5+A+u/HQAar372aot4tQSEEJTBGY9JNMxFkvWhQtg5WCwWrBZHV5SWL+jl2U68J3psS+JAQdp47bDZ5WXg4Moiofmfgw5grGVMUlKlGVAHFtjlBwmmhYQZubkQSJhIL2fDSMlc/Yoq/0KLcrLnN32qZmFEYCBWJBvxQcZ9I/TiQ8Kw/PEo+EpOAMwekJsqkEBWMRS+LUpXzGxenFo/KzPHkboDkM5c+/MjRpMBUPE07rJLNR5lPqLySSKrlEhLwkJV2noipxPU46nWQ+piH6L55jcGSchxZUvrcZVgwyeggjt3XjTizl0ujStS6jmtm061BGRjwoK6HzdBmvIp95nAd/qsCakXbjWD83/QlHdNnMumy/SNw/f4L6PQLv4SN4y6sZff1G/pghHWT+KrgTwlt6jAu7BFV7BSflbz/1tbG5uY65mPxr5J0Q714M8Ky3m+H+Xgb7epgZG6UoZ815o3+5cVKYcp+Z2+odxNpKgS8bq2ysr7i1KIfU+h8xiR7V0DQVLRZjQY/xaUHnBxa03IJBZiGJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 4\"\n        title=\"20210308 4\"\n        src=\"/static/8f2db79db833922ce729afa1d5df5d18/c1b63/20210308-4.png\"\n        srcset=\"/static/8f2db79db833922ce729afa1d5df5d18/5a46d/20210308-4.png 300w,\n/static/8f2db79db833922ce729afa1d5df5d18/0a47e/20210308-4.png 600w,\n/static/8f2db79db833922ce729afa1d5df5d18/c1b63/20210308-4.png 1200w,\n/static/8f2db79db833922ce729afa1d5df5d18/c1bea/20210308-4.png 1388w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>하드디스크 설정 등을 거쳐 가상머신이 생성되면 실행해본다. 가상머신이 시작될 디스크를 선택하라는 메세지가 나오는데, 다운받았던 우분투 서버 이미지 파일(<code class=\"language-text\">.iso</code>)을 선택해서 부팅한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACl0lEQVQoz42Sy08TURTGb2KiC1cu/BPc6NbowmhcqYkCAgvLFIEaQR660EQjGggLNRg3bCQxGIPviBpfKPRJW6BQoKUPpEyfUGin7TClFRDczOeZaXFhQsLil+/MOTffOffcYbV1HGp1WrlGp0UNxdqqSlRzlaQVaGyoQ0vTJTQ36nCtpR4Nl2vAacoL9SJKrNGUy3Wa87jOla6xm2eOy21nT6Dt1FE84Ergczkx43Xjp9eFgN9DTGNWwTeNGU8hp9S2UHKR4Czi0aC8EA6AlTGGG4cPyrerdejQVoH3TsE1OQ735Bi8rgl4qIFrwgGfW4kn4J+mutOh1pV4cT6M5XRCXs9LWF0RZfa1uxv3e75B0/oU7d2faBoPrGY9Ru1DsFmMGLGaMWTSwzlqx4jNAsewFfYhI8ZGbGrsdNhhMxvUZqKwCNZ+twsf9ePo7TOg53k/TTIF40A/mRpgMQ6S2SCGrSbV1GIYgJXUpP9BfCdjEzW2wG4xkPEwpHQS7EJFE45wHXjZ+xnVjZ3weT20Qxe8dB0f4acd+WmnXvekmlP2q+QCP32Iz0cgZYQC6SUiDvaovASVzZ24dacL3JV7CPFzWIiGEAvzmI8EVeKxMC1+DtHQHBLxGCmPfFbEak5CLptBfkXCciqGTJIHa93L4Oh6CNubD+itv4psPEIHROSWBSL1j7xUICcKyNN3NpNANk1kkmq8IqaINFj9HoYnJw/hLVeGx6ePIRnlkZPSNP7W4e0QyEBQNatqIc/O7WbQ7mMo3cVw8cB+JKJBuk6m2FXYnqLB/3k28PoZzO9fwfTuBexf+iAm48XOyR1MmKLdJZT/UFX1lf9srGHz9yo2STfWf+3QLFl4WdoZHwohwPP0mAGklhbwF7nACup1iIphAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 5\"\n        title=\"20210308 5\"\n        src=\"/static/8671a5700e30b625dde2600082d541ff/c1b63/20210308-5.png\"\n        srcset=\"/static/8671a5700e30b625dde2600082d541ff/5a46d/20210308-5.png 300w,\n/static/8671a5700e30b625dde2600082d541ff/0a47e/20210308-5.png 600w,\n/static/8671a5700e30b625dde2600082d541ff/c1b63/20210308-5.png 1200w,\n/static/8671a5700e30b625dde2600082d541ff/6c2de/20210308-5.png 1334w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>가상머신이 부팅되었고 우분투 환경 세팅이 시작된다. 가상머신이 할당받은 IP를 우선은 기록해둔다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAB2HAAAdhwGP5fFlAAABHElEQVQoz92S0W6CMBSGez2h7WkLhbYgZoo6CS7ZzZi7Qm+c2bsO3APupMwlJi7R7G5f/hz+lH6hSSFd67ptdnxf9m9lf1h0+9mw4uNLi3Efret3+XGXfx7Kfj/tWouLZBrDPFWbx6qpFpv1CtOsytd6ifOlmuN8fphhwdSFXU/c0/y+nmRozbQgAQeMyfLEOp2aODWgIgoCpy+SCYzCBIyPGA8owzJYBAA456WnKIrxeJwkiVJKax1FEZY4jofyM6WU4CHDwxhjrXXOoRN7hEeeEOecyfg19HHiCzwIXMe3zE/ALRD4A/9OxvuQAn8WELfLPGTsjsKIA+O3yAI4ZaZ2bjuBRisX/eYTeokgCHSepKUNDQMJNLy4i34Bny1WDavyRx4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 6\"\n        title=\"20210308 6\"\n        src=\"/static/9246357bb14207fa5d1a9df190d4e6a3/5a190/20210308-6.png\"\n        srcset=\"/static/9246357bb14207fa5d1a9df190d4e6a3/5a46d/20210308-6.png 300w,\n/static/9246357bb14207fa5d1a9df190d4e6a3/0a47e/20210308-6.png 600w,\n/static/9246357bb14207fa5d1a9df190d4e6a3/5a190/20210308-6.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>프로필 세팅을 거치고, OpenSSH 서버를 설치할 것인지를 묻는데 체크해줬다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAB2HAAAdhwGP5fFlAAABLElEQVQoz82SXU+DMBSGuTVjLad8FVraOTeYGYbIHfFKN0ycvxbYD/SsZMiUJe7OJyftS9OnhxSs5k02u6Q9ZN0hxdDsZLdXWMd3fax1W6uuVu3+u46fWfuxal4FitYqgCzyXoptlW+qPKu2abnSuYpwLJbJk47L9QLD84PCKhaiTO8fE47WOmSW7QAWATZ3AMsLuc8jrEgmYSzcILSpMyOnwmAyPQVjWQDAGJNSxnHcj0IIDJxzDPjoXRIEAZyx+gmXQoPv+73Wm9IgRmitsdmFjLgGPBtGOIZxppT+7DyAp/bvNuCfGRpelYcOY/rF3zsn5L/zH2W8HpcB3hG7VWaA/xG9IzDDj+PcIqNJqChUsl86VeBJH674FpnCtu1Q8SgV85iCC2Q+uYt8AdWJVcFQC8dSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 7\"\n        title=\"20210308 7\"\n        src=\"/static/5238325ed32ac2232c1e30746997c5ab/5a190/20210308-7.png\"\n        srcset=\"/static/5238325ed32ac2232c1e30746997c5ab/5a46d/20210308-7.png 300w,\n/static/5238325ed32ac2232c1e30746997c5ab/0a47e/20210308-7.png 600w,\n/static/5238325ed32ac2232c1e30746997c5ab/5a190/20210308-7.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>우분투가 추가적으로 서버용 툴들 설치할지 확인하고 있다. 어차피 도커를 설치해야 하니 여기서 docker를 선택했었는데, 여기서 설치하면 <code class=\"language-text\">snap</code>으로 설치되기 때문에 <code class=\"language-text\">apt</code>로 설치한 도커와 설치 위치가 달라져 나중에 쿠버네티스 설치가 조금 힘들었다. 그냥 취소하고 자신의 방법대로 <strong>우분투 설치 완료 후 설치</strong>하자.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAB2HAAAdhwGP5fFlAAAB9UlEQVQoz22R65KaQBCFfQBBQWBghos3QAUveIM1lVRiNj+2Ng8b3TxgPplNbWntKWqqmT6nT3dP53IOLz+j62t+ecmur9kt+JXcLp/j63NEqv1CHfw5h39/528v6eWHgtOZelYeON8P1ddqeVoXXzblUzlrivQ4m5zK/NumqOfTpzJvFulpeTu36ahIJKpU2J1u3zIsOxlPxmnmeMK0bNv1hFSuLz2phAqFPlXoBVLIcOAJy3FR8XUsC7o9mUyWy+VwODRNMwiCw+FQVdV6vc6ybDwe53metiCAGUUREoQ38WAwIAF1Op1CTZJkt9tRa7VacS4WC8oppbhHJqUMwxDJnXi/3+vCYLvdbjYb/Nct6AiZLuF5nu/7juP0+/33thHjQ23DMCDhXBQFnpxlWc5mM/RCCDScmOP3Liai4aZp6Lnb7dIVnnpO7lFyn/4HBndinFkM4yEjQW96ZnZG8zgTUItGuNQrfFwYJKrqro7HIzI0enjWQXbYQrZ4bBsqheM4JseSiBmYRdA2bvP5HHNoBI/OJJgZHu8slcSqrutqW9VNjZ4q1KIiBP0iH2KioAXL5Jfz9qQyikQY+5GSSjc8Go2cFq7rfohBv4WOLdsyu4ZfyuCcmLVjK6dn9DSse3TMz2B0DREHQaYM2bMcyzSMT2n/AJfMek/hPgQCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 8\"\n        title=\"20210308 8\"\n        src=\"/static/bfabe1198869e8ede4b4da458b5841ff/5a190/20210308-8.png\"\n        srcset=\"/static/bfabe1198869e8ede4b4da458b5841ff/5a46d/20210308-8.png 300w,\n/static/bfabe1198869e8ede4b4da458b5841ff/0a47e/20210308-8.png 600w,\n/static/bfabe1198869e8ede4b4da458b5841ff/5a190/20210308-8.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>다음 화면이 나오면 우분투 서버 20.04 설치 완료! 가상머신을 재부팅한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAB2HAAAdhwGP5fFlAAABn0lEQVQoz42S2Y6bQBBFec+Y3SzGYBw3ewBvwOQxJJGyfaxNfjBnIGMNUpBy1Wp1V9epW00j3fvtvfeHn8nwPRp+pfev4e2Td+u3t94bx8vpS85nf/gSMH7/iIdv4t57BKXI1mPHqEXYZFFXJG0quky0mfhYxIznIm6S9895dInC3HcYRbAp9z4IoPSkarJuuN42PIj8Q1nWx/J4Kqo6r2pn65u2y6lqmLJmPCkq452s6GuLIKCkaZoxyvO8qqrO5/PpdLpcLlEUKYqi67o6SnsVa8uyyGf9F2bPIs9zYEqUZdm2bZZlxN+SizDRoiiapsGZKmma7nY727a1uRadgbEFpmcwZdT/tl3X9fV65cLwh8PBH7Ver6fURXjy4apglDiO6rqOdRAErus+zP8BU36z2ZAKjDn9x3GcJAn9c0rdRWfeY7/fYwvMjCfdrlar6c5TwiKMMOFteCcujDNb0zRph1mdi3KO48zaxhOSmbcVQtAtVw3DkNeihDUX8Znz5DNZTRF+OMjpa9G28UaPW0jyqNWrHlsYSL4iSfKC/gCpE2sT7fm1NgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 9\"\n        title=\"20210308 9\"\n        src=\"/static/b4c74b12a60109145f31f9ade05409ec/5a190/20210308-9.png\"\n        srcset=\"/static/b4c74b12a60109145f31f9ade05409ec/5a46d/20210308-9.png 300w,\n/static/b4c74b12a60109145f31f9ade05409ec/0a47e/20210308-9.png 600w,\n/static/b4c74b12a60109145f31f9ade05409ec/5a190/20210308-9.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>지금 생성된 가상머신을 마스터 노드로 사용하고, 워커 노드로 사용할 가상머신을 3개 더 만들자. 지금 했던 과정을 3번 더 반복하고, 각 노드의 이름만 <code class=\"language-text\">node1</code>, <code class=\"language-text\">node2</code>등으로 설정해주었다.</p>\n<p>(나중에 보니 VM 화면에서 가상머신을 우클릭하고 복제를 누르면 된다. 물론 복제 후 노드 이름은 변경해줘야 한다.)</p>\n<h2 id=\"가상머신-포트포워딩\" style=\"position:relative;\"><a href=\"#%EA%B0%80%EC%83%81%EB%A8%B8%EC%8B%A0-%ED%8F%AC%ED%8A%B8%ED%8F%AC%EC%9B%8C%EB%94%A9\" aria-label=\"가상머신 포트포워딩 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>가상머신 포트포워딩</h2>\n<p>호스트에서 가상머신들에 SSH 접속을 하기 위해서 포트포워딩 설정을 해줘야 한다.</p>\n<p>VirtualBox 화면에서 상단 메뉴의 Files > Preference를 클릭, Network 탭으로 가서 이전에 만들어두었던 NAT Network를 수정한다.</p>\n<p>Port Forwarding 버튼을 누르고 다음 화면처럼 세팅한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwElEQVQ4y61Ta1PbMBDUb6aBGdyktJl2gH7qT+sjhARDHDvxmxgrluW3tieTZBi+AdHMju7Op92VZLHR57Puy/AMw/OBGhoDjIxT6Hl4/gnfLgxcfr/A1Y+v+Hk1xvXlGGOqUe9zzw4jY6AMWvdrdKJYlm6Q8Sflr20kUYBSpAfI7RPKLEWR7WKh4+e5yvmhT38vBVcy42BJHKg0ifFgzpVjWyjyLWzrHvPZFDx5pPoMy8U9kscI039/sHaW2MQBJn9/I/Rd+K4Dcz5T1nIGx50qFvprWJYFx3FQVRX0iKIQUkp0XQfXdRGEIYqigG3baJoWZVlisVggyzKkaYq6blCVEunGA4sCt29crVb0oe4J4zjqCZRS8H2P8rgn0aJt2xJpDZvinES3nFPeQHUkRLtjobeGaZo96d5hHEUHhx45DHcO9U704rquKF5CCAFOhNpISyKSzpKJbbpTbXpHGjp/Ge/zl3VNogX3ta5tUNAFMX0zxxgdbbknzMmmHnvl9+AVIT824ccdasr+DPWlSHGcM6T/Rr8W9E+vLHKUUhDyN6PQ6wqJPM/AiYslkYdN6L4b89sJ7m5vcPcwwQ3N/wFs/B31YpSHSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210308 10\"\n        title=\"20210308 10\"\n        src=\"/static/fac9f2eed2b52c59534a48001e5072ac/c1b63/20210308-10.png\"\n        srcset=\"/static/fac9f2eed2b52c59534a48001e5072ac/5a46d/20210308-10.png 300w,\n/static/fac9f2eed2b52c59534a48001e5072ac/0a47e/20210308-10.png 600w,\n/static/fac9f2eed2b52c59534a48001e5072ac/c1b63/20210308-10.png 1200w,\n/static/fac9f2eed2b52c59534a48001e5072ac/6569d/20210308-10.png 1328w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>이제 각 노드는 다음 명령을 통해 접속할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> -p <span class=\"token number\">11001</span> node@127.0.0.1 <span class=\"token comment\"># Node1</span></code></pre></div>\n<p>자주 접속을 하게 될 것 같아서 호스트의 <code class=\"language-text\">~/.ssh/config</code> 파일을 다음과 같이 수정했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Host node1\n\tHostName 127.0.0.1\n\tUser node\n\tPort 11001\n\nHost node2\n\tHostName 127.0.0.1\n\tUser node\n\tPort 11002\n\nHost node3\n\tHostName 127.0.0.1\n\tUser node\n\tPort 11003\n\nHost node4\n\tHostName 127.0.0.1\n\tUser node\n\tPort 11004</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> node1</code></pre></div>\n<h2 id=\"각-노드에-kubernetes-설치\" style=\"position:relative;\"><a href=\"#%EA%B0%81-%EB%85%B8%EB%93%9C%EC%97%90-kubernetes-%EC%84%A4%EC%B9%98\" aria-label=\"각 노드에 kubernetes 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>각 노드에 Kubernetes 설치</h2>\n<p>먼저 도커부터 설치한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> -fsSL https://get.docker.com/ <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">sh</span></code></pre></div>\n<p>도커가 설치되면 <code class=\"language-text\">systemctl status docker</code> 명령을 통해 서비스가 동작하고 있는지(<em>running</em>) 확인하고 쿠버네티스를 설치한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> upgrade\n$ <span class=\"token function\">curl</span> -s https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> -\n\n$ <span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF<span class=\"token bash punctuation\"> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/apt/sources.list.d/kubernetes.list</span>\ndeb https://apt.kubernetes.io/ kubernetes-xenial main\nEOF</span>\n\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> -y kubelet kubeadm kubectl</code></pre></div>\n<p>쿠버네티스는 <strong>Swap이 설정된 머신에서는 동작하지 않고 에러</strong>를 낸다. Swap이 설정되어 있으면 pod들이 일관적인 성능을 내는 것을 보장할 수 없다고 한다. 쿠버네티스 개발진은 이를 해결할 수는 있지만, <strong>해결해서 얻는 이득이 딱히 크지 않다</strong>고 판단해 우선순위를 뒤로 미뤄둔 것 같다.</p>\n<p>다음 명령을 통해 swap을 영구적으로 비활성화한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> swapoff -a\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">sed</span> -i <span class=\"token string\">'/ swap / s/^\\(.*\\)$/#<span class=\"token entity\" title=\"\\1\">\\1</span>/g'</span> /etc/fstab</code></pre></div>\n<p>쿠버네티스 실행에 앞서 한 가지 더 필요한 설정이 있는데, <strong>쿠버네티스와 도커의 cgroup 드라이버가 동일해야 한다</strong>는 것이다. 도커의 cgroup 기본 드라이버는 <code class=\"language-text\">cgroupfs</code>인데, 쿠버네티스에서 권장하는 드라이버는 <code class=\"language-text\">systemd</code>라고 한다.</p>\n<p>우선 도커의 cgroup 드라이버를 확인해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> docker info <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -i cgroup\n\n<span class=\"token comment\"># output</span>\n<span class=\"token punctuation\">..</span>.\nCgroup Driver: cgroupfs\n<span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>다음 명령들을 통해 드라이버를 변경하고, 도커 서비스를 재시작한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 권한 부여</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> <span class=\"token environment constant\">$USER</span>:docker /etc/docker\n\n<span class=\"token comment\"># 도커 대몬 교체</span>\n<span class=\"token function\">cat</span> <span class=\"token operator\">></span> /etc/docker/daemon.json <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF\n{\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"100m\"\n  },\n  \"storage-driver\": \"overlay2\"\n}\nEOF</span>\n\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> -p /etc/systemd/system/docker.service.d\n\n<span class=\"token comment\"># 도커 서비스 재시작</span>\n$ <span class=\"token function\">sudo</span> systemctl daemon-reload\n$ <span class=\"token function\">sudo</span> systemctl restart docker</code></pre></div>\n<h2 id=\"kubeadm-이용해서-클러스터-구성\" style=\"position:relative;\"><a href=\"#kubeadm-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B5%AC%EC%84%B1\" aria-label=\"kubeadm 이용해서 클러스터 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubeadm 이용해서 클러스터 구성</h2>\n<p>kubernetes.io에 따르면 kubeadm은 <strong>쿠버네티스 클러스터 생성 용도의 툴</strong>로, 시스템 프로비저닝까지 다루지 않고 부트스트랩(bootstrapping)까지만 다루도록 설계되었다고 한다.</p>\n<p>여기서는 kubeadm을 이용해 클러스터를 구성할 것이다. </p>\n<p>마스터 노드에서 다음 명령을 입력해 클러스터를 구성한다.</p>\n<p>(물론 kubeadm init 명령에서 IP는 자신이 세팅한 마스터 노드의 IP로 설정한다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> kubeadm init --apiserver-advertise-address<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.2.15\n\n$ <span class=\"token function\">mkdir</span> -p <span class=\"token environment constant\">$HOME</span>/.kube\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> -i /etc/kubernetes/admin.conf <span class=\"token environment constant\">$HOME</span>/.kube/config\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> -u<span class=\"token variable\">)</span></span><span class=\"token builtin class-name\">:</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> -g<span class=\"token variable\">)</span></span> <span class=\"token environment constant\">$HOME</span>/.kube/config\n\n<span class=\"token comment\"># root 권한으로 설정</span>\n$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">KUBECONFIG</span><span class=\"token operator\">=</span>/etc/kubernetes/admin.conf</code></pre></div>\n<p>마스터노드에서 <code class=\"language-text\">kubeadm init</code> 명령이 완료되면 그 클러스터로 참가할 수 있는 명령이 출력된다. 이 명령을 워커 노드에서 입력해야 하므로 복사해둔다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> kubeadm <span class=\"token function\">join</span> <span class=\"token number\">10.0</span>.2.15:6443 --token 8rzhrw.av7q1aoyqwsco3q --discovery-token-ca-cert-hash sha256:3be2271256e896a6762f7b39a69f38c990cafbfd39ab92c01df6fdbf4bfc3d9</code></pre></div>\n<p><code class=\"language-text\">Calico</code>라는 두 가지 애드온을 설치한다. 마스터 노드에서 입력하자. 이는 CNI(Container Network Interface) 플러그인으로, <strong>기본 쿠버네티스 자체적으로는 pod간 통신을 위한 네트워크를 구성해주지 않기 때문</strong>에 추가로 설치해 사용하게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> kubectl apply -f https://docs.projectcalico.org/v3.8/manifests/calico.yaml</code></pre></div>\n<p>이제 마스터 노드의 설정이 끝났고, 위에서 복사해둔 <code class=\"language-text\">kubeadm join</code> 명령을 각 워커 노드에서 실행하면 클러스터 구성이 완료된다.</p>\n<p>워커들이 클러스터에 제대로 참여했는지 마스터 노드에서 확인해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> kubectl get nodes\n\n<span class=\"token comment\"># output</span>\nNAME    STATUS   ROLES                  AGE   VERSION\nnode1   Ready    control-plane,master   40m   v1.20.4\nnode2   Ready    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>                 21m   v1.20.4\nnode3   Ready    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>                 21m   v1.20.4\nnode4   Ready    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>                 21m   v1.20.4</code></pre></div>\n<h2 id=\"troubleshooting\" style=\"position:relative;\"><a href=\"#troubleshooting\" aria-label=\"troubleshooting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Troubleshooting</h2>\n<p>이번 포스팅에서 다룬 가상머신으로 클러스터 구성한 것과, 연구실 서버로 클러스터 구성하면서 해결한 몇몇 에러를 소개한다. 아직 쿠버네티스 실력 수준이 낮고, 복잡한 클러스터를 다뤄보지 못해서 이 정도 에러만 소개하고 포스팅을 마치려 한다.</p>\n<h3 id=\"워커-노드들의-status가-전부-notready로-뜨는-경우\" style=\"position:relative;\"><a href=\"#%EC%9B%8C%EC%BB%A4-%EB%85%B8%EB%93%9C%EB%93%A4%EC%9D%98-status%EA%B0%80-%EC%A0%84%EB%B6%80-notready%EB%A1%9C-%EB%9C%A8%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"워커 노드들의 status가 전부 notready로 뜨는 경우 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>워커 노드들의 Status가 전부 NotReady로 뜨는 경우</h3>\n<p>Calico 애드온 설정을 빼먹어서, 진행해줬더니 Ready 상태로 변경되었다.</p>\n<h3 id=\"kubelet-서비스가-실행되지-않는-경우\" style=\"position:relative;\"><a href=\"#kubelet-%EC%84%9C%EB%B9%84%EC%8A%A4%EA%B0%80-%EC%8B%A4%ED%96%89%EB%90%98%EC%A7%80-%EC%95%8A%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"kubelet 서비스가 실행되지 않는 경우 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubelet 서비스가 실행되지 않는 경우</h3>\n<p>마스터 노드에서 클러스터에 계속 접속이 되지 않아 kubelet 서비스가 제대로 동작하고 있는지 확인을 해봤다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> systemctl status kubelet</code></pre></div>\n<p>보통 때면 초록색으로 active (running)이 표시될텐데 그렇지 않았다.</p>\n<p>이 상황은 세 번을 겪었는데, <ins>한 번은 도커가 실행되지 않고 있던 경우</ins>, 도커는 실행되었지만 <ins>도커와 쿠버네티스의 cgroup 드라이버가 서로 맞지 않던 경우</ins>, 마지막으로 <ins>머신에 swap이 켜져있던 경우</ins>였다.</p>\n<p>journalctl 명령을 통해 kubelet 서비스의 로그를 먼저 확인해서 각 경우를 해결했다.</p>\n<p>도커와 쿠버네티스 cgroup 드라이버가 일치하지 않던 경우는 위에서 했던대로 도커의 드라이버를 변경해주고 서비스를 재시작하면 바로 해결되었다.</p>\n<p>swap이 켜져있던 경우도 위에서 설정했던대로 다시 swap을 꺼주었다. swap을 비활성화하는 <code class=\"language-text\">swapoff -a</code> 명령만 수행했더니 영구적으로 적용되지 않아 머신이 재부팅한 후에 swap이 다시 활성화됐던 것이었다. 그 밑의 명령까지 수행하자.</p>\n<p>도커가 실행되지 않던 상황은, /etc/docker/daemon.json 파일이 어떤 이유로 비워졌기 때문이었다. cgroup 드라이버 변경할 때 넣었던 내용을 다시 입력해주었다.</p>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h2>\n<ul>\n<li>VirtualBox 설치 : <a href=\"https://phoenixnap.com/kb/install-virtualbox-on-ubuntu\">https://phoenixnap.com/kb/install-virtualbox-on-ubuntu</a></li>\n<li>Swap을 꺼야하는 이유 : <a href=\"https://github.com/kubernetes/kubernetes/issues/53533\">https://github.com/kubernetes/kubernetes/issues/53533</a></li>\n<li>kubeadm : <a href=\"https://velog.io/@seunghyeon/Kubeadm%EC%9C%BC%EB%A1%9C-K8S-%EA%B5%AC%EC%84%B1\">https://velog.io/@seunghyeon/Kubeadm으로-K8S-구성</a></li>\n<li>가상머신 구성 : <a href=\"https://velog.io/@evanjin/kubernetes-virtualbox%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%EC%84%A4%EC%B9%98mac-ijk495l4e9\">https://velog.io/@evanjin/kubernetes-virtualbox를-이용하여-설치mac-ijk495l4e9</a></li>\n<li>Calico, Flannel : <a href=\"https://jonnung.dev/kubernetes/2020/02/24/kubernetes-pod-networking/\">https://jonnung.dev/kubernetes/2020/02/24/kubernetes-pod-networking/</a></li>\n</ul>","frontmatter":{"title":"VirtualBox로 가상머신 만들어 Kubernetes 클러스터 구성하기","date":"March 08, 2021"}}},"pageContext":{"slug":"/cloud/virtualbox_k8s/","previous":{"fields":{"slug":"/cloud/serverless_and_cold_start/"},"frontmatter":{"title":"서버리스 아키텍처(Serverless Architecture)와 콜드 스타트(Cold Start)","category":"Cloud","draft":false}},"next":null}},"staticQueryHashes":["3128451518","521680639"]}