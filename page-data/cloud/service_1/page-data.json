{"componentChunkName":"component---src-templates-blog-post-js","path":"/cloud/service_1/","result":{"data":{"site":{"siteMetadata":{"title":"Fr3ky's Lab.","author":"Freckie","siteUrl":"https://blog.frec.kr","comment":{"disqusShortName":"","utterances":"freckie/freckie.github.io"},"sponsor":{"buyMeACoffeeId":"freckie"}}},"markdownRemark":{"id":"f35fcae2-dd6f-58a3-8d3b-58f0233c9ca6","excerpt":"이 포스팅은 Marko Lukša의 Kubernetes in Action (1st edition)에서 Chapter 5. Services: Enabling Clients to Discover and Talk to Pods를 기반으로 재구성하였습니다. 서비스에 관련된 내용은 총 3편의 시리즈로 포스팅할 예정입니다. 쿠버네티스 서비스 1 쿠버네티스 서비스 2 쿠버네티스 서비스 : 인그레스 (작성 중) 1. 서비스(Service)의 등장 배경 먼저 서비스(Service…","html":"<p>이 포스팅은 Marko Lukša의 Kubernetes in Action (1st edition)에서 <em>Chapter 5. Services: Enabling Clients to Discover and Talk to Pods</em>를 기반으로 재구성하였습니다.</p>\n<p>서비스에 관련된 내용은 총 3편의 시리즈로 포스팅할 예정입니다.</p>\n<ul>\n<li><strong>쿠버네티스 서비스 1</strong></li>\n<li><a href=\"https://blog.frec.kr/cloud/service_2/\">쿠버네티스 서비스 2</a></li>\n<li><a href=\"https://blog.frec.kr/cloud/service_ingress/\">쿠버네티스 서비스 : 인그레스</a> (작성 중)</li>\n</ul>\n<hr>\n<h2 id=\"1-서비스service의-등장-배경\" style=\"position:relative;\"><a href=\"#1-%EC%84%9C%EB%B9%84%EC%8A%A4service%EC%9D%98-%EB%93%B1%EC%9E%A5-%EB%B0%B0%EA%B2%BD\" aria-label=\"1 서비스service의 등장 배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 서비스(Service)의 등장 배경</h2>\n<p>먼저 서비스(Service)라는 쿠버네티스 리소스가 등장하게 된 배경을 살펴본다.</p>\n<p>쿠버네티스 상에서 파드(Pod)는 기본적으로 격리되어 있다. 그러나 요즘 대부분의 어플리케이션은 외부의 요청에 결과값을 반환하길 원하고, 이를 위해서 파드들은 다음의 마이크로서비스 아키텍처 그림과 같이 다른 파드에 요청을 하기도 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 539px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqUlEQVQ4y21Uy27TUBD1z/AJfABiz4IPQKz4AFgiVqhiwaIbQKAioS7YtCoKUhftJpVo+oKWplFDSZs4ie34GT/j5/XjMHZTKxUd6cq69tw5c+acay5IMihOjMXICqA38WEHabUv5u99Snu1/gdPPhyD14I6P2Y5orRASLW4xsEIK5ttnI8tFFkGyxngoHuM1Z0u1loDOF6AOGZwXBGdwW88WznDo7f7aHZkhGEIdepCNHwIigHZ9MGt/RjgU+MXjvtmheYFQ7TO9/B+Yw9ftjqYRQxFDmhmH6rdgaZqkAQeFgE5swCq6WFMBXlJo4IBOH4yxe7ZEHme1xRYBnRFH0P6lqcMaZoiimI4ITDUPIxoaW5S55djKyn7MVHOs5SoUhdFQQvV82ZqLInheh5M06znWM14jp1XZ4pb8+cWN8U8oVxZXoBRZ2UxbzZDCaw4DE8/nuDhUguHfbs+N50l0D0GnbrmFouUnRWLqDmrCpZhWANcjA7wptHD89VTnFxpFdBINqDZAXRdh+2F1x3ebvo6xGmANm+AMUbzS0gECRPrCqqsQBX5qogf0lz9CIIRgJ8YkKak8v6Fhu+HAgw3IjVzZFmEC0nBg6V93HvRxOaJDNs06H2BhGw5Lg9rPtwwrcGTNK+ELP3Ivds4wvLXHex2VaKYQTcviV4LW0c9rDfb1GkI2/WRJPF/LO4U5ZS3sH2qkN/SeVJG1MgakgpRGGOs2kjJ8DHZhiyJz80hXn/7SzlRXSQqbwqb35QkjjDz3BrxJpwoJ/XS6jYEQQTbnqAz7OHx8k/cf7mD7bZM/iTR3IBY+BA1C7JFxs7IVKVxb1ov7qBRhmb1IOp7EEUZfP8SU9uja+pBUM1KIEGUquLcXR5ctM8igE1CDBSXlnPrh1L60PRTGF6Cfw8MHu5ZKRdzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210726 1\"\n        title=\"20210726 1\"\n        src=\"/static/0e46e230bd6efa8252065a557ce593ff/10f9a/20210726-1.png\"\n        srcset=\"/static/0e46e230bd6efa8252065a557ce593ff/5a46d/20210726-1.png 300w,\n/static/0e46e230bd6efa8252065a557ce593ff/10f9a/20210726-1.png 539w\"\n        sizes=\"(max-width: 539px) 100vw, 539px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>파드가 서로 격리된 상황에서, 파드는 다른 파드로 접근하기 위한 방법을 찾아야 한다. 쿠버네티스가 아닌 상황이었다면 시스템 관리자가 직접 각 서버의 IP로 접근하도록 할 수 있었겠지만, 쿠버네티스에서 이 방법은 좋은 방법이 아니다.</p>\n<p>그 이유로 책에서는 다음 세 가지 이유를 들고 있다.</p>\n<ol>\n<li>파드는 <strong>언제든지 생성되고 소멸</strong>될 수 있는 존재다. (ephemeral)</li>\n<li>쿠버네티스가 파드에 IP를 할당할 때, 파드가 노드에 스케줄 되고 나서 시작되기 전에 IP가 할당된다. 때문에, 클라이언트가 <strong>타겟 파드의 IP 주소를 알기 어렵다</strong>.</li>\n<li>쿠버네티스의 스케일링은 파드의 수를 늘리는 걸 뜻하는데, 이때마다 할당되는 IP를 클라이언트가 매번 알게 하기는 힘들다.</li>\n</ol>\n<p>이렇게 변화가 잦은 파드를 통해서 애플리케이션을 서비스하려면, 사실상 파드의 IP를 이용해 접근하는 것은 불가능에 가깝다는 것을 깨달았다. 클라이언트의 입장에서 생각해보면, 접근할 수 있는 <strong>단 하나의 창구</strong>를 원할텐데, 이런 배경에서 쿠버네티스는 <em>서비스(Service)</em>라는 리소스를 소개하고 있다.</p>\n<h2 id=\"2-서비스\" style=\"position:relative;\"><a href=\"#2-%EC%84%9C%EB%B9%84%EC%8A%A4\" aria-label=\"2 서비스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 서비스</h2>\n<p>서비스는 같은 애플리케이션을 구동하는 파드들에 대해서, 변하지 않는 하나의 접근 포인트를 제공하는 것을 목표로 한다. 직접 바꾸지 않는 한 <strong>변하지 않는 IP 주소와 포트를 노출</strong>해서, 연결된 파드가 더 생기든 말든 클라이언트는 신경쓰지 않도록 한다.</p>\n<p>프론트엔드와 백엔드로 나뉘어 쿠버네티스 상에 배포된 웹 서비스를 예시로 들어보겠다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 889px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5klEQVQ4y5VT708TMRje//8PKCb6Cb+ZTDEMNSCYsLGBosNpDsaysXEZ+3G7XW/X3vXae3zbMgdDDTZ50/Zp36fP07ctYa1ppaFUDq31vcjzHFmW3kZmMc45JpMJgiDAeDxGHMco+dNLNLwKjr33+NrZQxhNKVlZAhuKxjJHFM0wHPbh+1dEMKI16QTcHlgUhT2odD1to/ZjC0etbXxpf8Bs7giNSqVcn2USQiRgLMCc1gWP7WHrzRKug0ppS5hRsMUCCdmSUto+jCIEYYh4kUBSMufC7RGCnGhHaKQWxUq2JkXVzgBP94/wjKJ8dm7xes/HxkEdG3tVvPrmgUCcDG7w5GPNYuWzC8RJsiR04RTmGIYRWn0fratr9KYhHaIwimKLfe8N0J3MLDZmC4d1+xYTpPS35SWhsSfTFFqSJapaJritnuBkk8Y8ZrZfYimpyug6NOWZqj8gNJdt7ZsxqZC5K45ZZ3GCYDa368YyY4yq7tunczMa2flfCdfbz/MBytsNvKkcY/+whUUi/l3lPxHevdv65ws839zFi5e7eF05QcSSB3v+i5BmRMLJMsPdnEcRrkhWzWv72Nqp4e27GqoNz77XR1s2lTaFWH6/ghRfdoc4OGziU7WJ02bn3h73oxRSeh2/AO/Y5WYJJML3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210726 2\"\n        title=\"20210726 2\"\n        src=\"/static/e8c56bb1210007f40fc01efe5592ab2e/83e77/20210726-2.png\"\n        srcset=\"/static/e8c56bb1210007f40fc01efe5592ab2e/5a46d/20210726-2.png 300w,\n/static/e8c56bb1210007f40fc01efe5592ab2e/0a47e/20210726-2.png 600w,\n/static/e8c56bb1210007f40fc01efe5592ab2e/83e77/20210726-2.png 889w\"\n        sizes=\"(max-width: 889px) 100vw, 889px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>프론트엔드 파드는 사용자 로그인 웹 페이지를 제공하는 웹 서버로, 백엔드 파드를 로그인 로직을 처리하는 API 서버로 생각을 해보자. API 서버에서 문제가 생겨서 파드가 재시작되거나, 요청이 너무 많아져서 추가로 파드가 생성되었을 수 있다.</p>\n<p>쿠버네티스에서 파드의 재시작은 새로운 파드를 생성하고 기존 파드를 삭제하는 방법으로 이루어지므로, <strong>파드의 IP가 바뀔 것은 분명</strong>하다.</p>\n<p>백엔드 파드에 연결되는 서비스 리소스를 생성하면, 프론트엔드 파드에서는 서비스의 IP를 통해 파드에 일관되게 접근할 수 있다.</p>\n<p>서비스의 생성은 <code class=\"language-text\">kubectl expose</code> 명령이나 서비스 YAML 파일을 통한 방법이 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl expose deployment api-server --name<span class=\"token operator\">=</span>api-service</code></pre></div>\n<p><code class=\"language-text\">api-server</code>라는 이름의 Deployment와 연결되는 서비스를 생성하고, <code class=\"language-text\">api-service</code>라는 이름을 붙인다.</p>\n<p>다만 YAML 파일에 명세를 작성하는 것이 kubectl 명령을 통해 생성하는 것보다 더 유연한 설정이 가능하기 때문에, 이 포스팅에서는 YAML 파일을 작성해 서비스를 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api-service.yaml</span>\n\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> api<span class=\"token punctuation\">-</span>service\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> api<span class=\"token punctuation\">-</span>server\n\t<span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n\t\t<span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span></code></pre></div>\n<p><code class=\"language-text\">metadata.name</code> 항목은 생성할 서비스의 이름을 뜻한다.</p>\n<p><code class=\"language-text\">spec.selector</code>의 <code class=\"language-text\">app: api-server</code>는 <strong>서비스와 연결될 파드들을 식별</strong>하는 용도의 <em>라벨 셀렉터(Label Selector)</em>이다. 파드에 app: api-server 라고 라벨이 붙어있으면, 이 서비스와 연결된다.</p>\n<p><code class=\"language-text\">spec.ports.port</code>는 서비스가 노출할 포트, <code class=\"language-text\">spec.ports.targetPort</code>는 연결할 파드의 포트를 뜻한다. 즉, {서비스의 IP}:80 → {파드의 IP}:8080 로 연결된다.</p>\n<p>어떤 서비스들은 포트를 여러 개 오픈해야 할 수도 있다. 예시로, 80포트를 통해 HTTP 연결을 열고, 443 포트를 통해 동시에 HTTPS 연결을 열어야할 수 있다. 이 경우에는 <code class=\"language-text\">spec.ports</code> 하위에 다음과 같이 추가로 작성하면 된다. 물론 이 포트 항목에 대해 이름도 지정할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># ...</span>\n<span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n\t\t<span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n\t\t<span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n\t<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> https\n\t\t<span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">443</span>\n\t\t<span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8443</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p>이렇게 생성된 서비스는 <code class=\"language-text\">kubectl get svc</code> 명령으로 확인해볼 수 있으며, 가장 기본적인 서비스 타입인 <em>ClusterIP</em> 타입으로 생성되었다. 서비스의 타입은 다음이 있다.</p>\n<ol>\n<li>ClusterIP 서비스</li>\n<li>NodePort 서비스</li>\n<li>LoadBalancer 서비스</li>\n<li>Ingress (서비스의 타입은 아니고 서비스를 관리하는 리소스이다. 시리즈의 마지막에서 자세히 다룬다.)</li>\n</ol>\n<p>ClusterIP, NodePort, LoadBalancer 타입에 대해서는 다음 포스팅에서 살펴본다.</p>\n<h2 id=\"3-서비스에-접속하기\" style=\"position:relative;\"><a href=\"#3-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%97%90-%EC%A0%91%EC%86%8D%ED%95%98%EA%B8%B0\" aria-label=\"3 서비스에 접속하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 서비스에 접속하기</h2>\n<p>다음 그림은 책에서 제시하는 예시인데, 서비스에 연결된 백엔드 파드 중 하나에서 서비스에 curl로 요청을 보낸 상황이다.</p>\n<p><code class=\"language-text\">$ kubectl exec kubia-7nog1 —curl -s http://10.11.249.153</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 967px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACHElEQVQoz22T627TQBCF8/iIF4BfSBUqF4kXoBekAio/UFtRpU0bJ3Zsx+tLHF/ie9LkY7wBBaGuNdLu2dkz3jlnB7vdjmdDvqqqiKKIOI6p65ogCJhOJ5jmlLIs8X2fu+GQyWSCZZm0bcvgOTLh0qNP6EmSZUKe5yhPYYzHEgZpkpJlGWEY0jStPrfd7vaE/4/tbsvmaUPbNaw3nZ43Ta3nVV3SrVvZa3XBp+2GuqkkZy2ETwx6gj37VgP9iDKHL7+OOb95x+n1EffOJcHS5mL4gbPrY06ujhja3wgTV7CPnF0dc3r1luvpyeEPlVKMRiPMqYUXmESJiWXfES5MgtjE8Q1iKWS5I1lb+BqbsMxdjYXxDCccHQj7pvfNL1YlwcJlkebMvFiIRZiljyuH4ziSgia+8nWO7RkiWoAlWKACXDWVKwthXRZa0aZpNHkYzzEv32Odv8a5eMPcumEe2qJsSlmsaKSPcaJQ0YyiyESwVLAKP7IYqDTj1nbouk4Tih6yYfPw9RXjzy94PHmJNfmBv5yTFnPKZkHZLqR/M7m2LZgiyRVFHeEEcuWfjw6fvt+Kap0m7WNVZnipxzzzcZYucR5RlDm2/yDxiOXdEwpeVivc0BCisRQ0JU8xqKuWPC20ypF4qjepYRgU+ergoz/OSpOMmWUzdzzW3YbnxuDfRW/Snqw3c+87/V6kB3+F++vPvb12Og4PYp/3Gx39PFHOpVGDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210726 3\"\n        title=\"20210726 3\"\n        src=\"/static/bf3d28255905a0150fcd622b2a84238e/aa08e/20210726-3.png\"\n        srcset=\"/static/bf3d28255905a0150fcd622b2a84238e/5a46d/20210726-3.png 300w,\n/static/bf3d28255905a0150fcd622b2a84238e/0a47e/20210726-3.png 600w,\n/static/bf3d28255905a0150fcd622b2a84238e/aa08e/20210726-3.png 967w\"\n        sizes=\"(max-width: 967px) 100vw, 967px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>이 그림에서 중요하게 볼 것은, 서비스 리소스에 요청이 들어갔을 때, 쿠버네티스의 프록시가 이 연결을 가로채서, <strong>랜덤하게 선택된 백엔드 파드로 포워딩</strong>해준다는 것이다.</p>\n<p>이렇게 해서 지금까지 서비스에 대해 대략적으로 알아봤고, 백엔드 파드에 대해 접속할 수 있는 IP 주소와 포트를 얻었다. 다만 여기서 한 가지 의문이 생길 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 889px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5klEQVQ4y5VT708TMRje//8PKCb6Cb+ZTDEMNSCYsLGBosNpDsaysXEZ+3G7XW/X3vXae3zbMgdDDTZ50/Zp36fP07ctYa1ppaFUDq31vcjzHFmW3kZmMc45JpMJgiDAeDxGHMco+dNLNLwKjr33+NrZQxhNKVlZAhuKxjJHFM0wHPbh+1dEMKI16QTcHlgUhT2odD1to/ZjC0etbXxpf8Bs7giNSqVcn2USQiRgLMCc1gWP7WHrzRKug0ppS5hRsMUCCdmSUto+jCIEYYh4kUBSMufC7RGCnGhHaKQWxUq2JkXVzgBP94/wjKJ8dm7xes/HxkEdG3tVvPrmgUCcDG7w5GPNYuWzC8RJsiR04RTmGIYRWn0fratr9KYhHaIwimKLfe8N0J3MLDZmC4d1+xYTpPS35SWhsSfTFFqSJapaJritnuBkk8Y8ZrZfYimpyug6NOWZqj8gNJdt7ZsxqZC5K45ZZ3GCYDa368YyY4yq7tunczMa2flfCdfbz/MBytsNvKkcY/+whUUi/l3lPxHevdv65ws839zFi5e7eF05QcSSB3v+i5BmRMLJMsPdnEcRrkhWzWv72Nqp4e27GqoNz77XR1s2lTaFWH6/ghRfdoc4OGziU7WJ02bn3h73oxRSeh2/AO/Y5WYJJML3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210726 2\"\n        title=\"20210726 2\"\n        src=\"/static/e8c56bb1210007f40fc01efe5592ab2e/83e77/20210726-2.png\"\n        srcset=\"/static/e8c56bb1210007f40fc01efe5592ab2e/5a46d/20210726-2.png 300w,\n/static/e8c56bb1210007f40fc01efe5592ab2e/0a47e/20210726-2.png 600w,\n/static/e8c56bb1210007f40fc01efe5592ab2e/83e77/20210726-2.png 889w\"\n        sizes=\"(max-width: 889px) 100vw, 889px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>이전의 웹 서비스 예시에서, 백엔드 파드와 프론트엔드 파드는 서로 독립적으로 생성되었다. 그렇다면 프론트엔드 파드에서는 백엔드 서비스의 주소를 모르지 않을까? 프론트엔드 어플리케이션을 만들 때 백엔드 서비스의 IP와 포트를 지정을 해둬야 할까?</p>\n<p>아무리 서비스의 IP가 바뀌지 않는다고 해도, 이렇게 IP를 하드코딩해두는 등의 방법은 우아하지 않은 선택인 것 같다.</p>\n<p>역시 쿠버네티스는 다음 두 가지 방법을 제공함으로써 이런 고민을 하게 놔두지 않는다.</p>\n<ol>\n<li>각 파드에 서비스의 IP와 포트가 <strong>환경변수</strong>로 등록되어 있다.</li>\n<li>서비스에 접근할 수 있도록 <strong>도메인 네임</strong>을 제공한다.  </li>\n</ol>\n<h3 id=\"각-파드에-서비스의-ip와-포트가-환경변수로-등록되어-있다\" style=\"position:relative;\"><a href=\"#%EA%B0%81-%ED%8C%8C%EB%93%9C%EC%97%90-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%9D%98-ip%EC%99%80-%ED%8F%AC%ED%8A%B8%EA%B0%80-%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98%EB%A1%9C-%EB%93%B1%EB%A1%9D%EB%90%98%EC%96%B4-%EC%9E%88%EB%8B%A4\" aria-label=\"각 파드에 서비스의 ip와 포트가 환경변수로 등록되어 있다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>각 파드에 서비스의 IP와 포트가 <strong>환경변수</strong>로 등록되어 있다.</h3>\n<p>첫번째 환경변수부터 설명을 해보자면, 쿠버네티스가 파드를 시작할 때 그 시점에 존재하는 환경변수를 그 파드에도 설정한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1133px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEElEQVQY01WOyU7EMBBE8/8/AH/AJpY7B7jCiLkRiYxEHNuJE2eDbB6SKIXbaIZJS0/VLbery3t8V7jecNxvBS5fI9y+CQfNpHeWG/v+sJWuv3hhthe42kQ4f945zp4OBPCSLMcnlyAVSiOSCeJUg8cKUmVoeoPW/PzpsF9p1Q6OxoxHPJUk2AUf4BGDFByCR8i1RvP9hbqunPZdh65trf5D89B32JsBp+WlaYogCCClhBACSikk9kie5zDGOKZpcstZliEMQzAWQdv3Qy3LcsTjnLslgnrGmPtYVRXKskRrk1CN4+jMtU1Ph0nrukZn05+aenEcr9JRT2bzPDsTghYpJSklp6MUwPd9FEWxMvwFdxy+W4O/b1YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20210726 4\"\n        title=\"20210726 4\"\n        src=\"/static/66c7219e1db56d8aa7178763cd9436bc/33c9c/20210726-4.png\"\n        srcset=\"/static/66c7219e1db56d8aa7178763cd9436bc/5a46d/20210726-4.png 300w,\n/static/66c7219e1db56d8aa7178763cd9436bc/0a47e/20210726-4.png 600w,\n/static/66c7219e1db56d8aa7178763cd9436bc/33c9c/20210726-4.png 1133w\"\n        sizes=\"(max-width: 1133px) 100vw, 1133px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>책에서는 <code class=\"language-text\">kubectl exec</code> 명령으로 파드에 환경변수를 확인하는 명령을 전달하고 있다.</p>\n<p>책에서 생성한 서비스의 이름이 <code class=\"language-text\">kubia</code>인데, kubia의 IP 주소와 포트가 KUBIA<em>SERVICE</em>HOST, KUBIA<em>SERVICE</em>PORT 환경변수로 등록되어 있는 것을 볼 수 있다.  </p>\n<h3 id=\"서비스에-접근할-수-있도록-도메인-네임을-제공한다\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4%EC%97%90-%EC%A0%91%EA%B7%BC%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8F%84%EB%A1%9D-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%84%A4%EC%9E%84%EC%9D%84-%EC%A0%9C%EA%B3%B5%ED%95%9C%EB%8B%A4\" aria-label=\"서비스에 접근할 수 있도록 도메인 네임을 제공한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서비스에 접근할 수 있도록 도메인 네임을 제공한다.</h3>\n<p>쿠버네티스 클러스터를 구성하면 <code class=\"language-text\">kube-system</code> 네임스페이스에 <strong><em>CoreDNS</em></strong>가 구동된다. 클러스터 내에서 발생한 DNS 쿼리는 CoreDNS를 통해서 쿠버네티스가 제어하게 된다.</p>\n<p>각 파드들은 서비스의 이름만 알고 있다면 FQDN(Fully Qualified Domain Name)을 통해 서비스에 접근할 수 있고, 이 FQDN의 해석을 CoreDNS가 맡는다.</p>\n<p>예시로, <code class=\"language-text\">default</code> 네임스페이스에 <code class=\"language-text\">api-service</code>라는 서비스가 생성되었다면, 다른 파드에서 이 서비스를 다음 도메인을 통해 접근할 수 있다.</p>\n<p><code class=\"language-text\">api-service.default.svc.cluster.local</code></p>\n<ul>\n<li><code class=\"language-text\">api-service</code>는 서비스의 이름을 뜻한다.</li>\n<li><code class=\"language-text\">default</code>는 해당 서비스가 속한 네임스페이스이다.</li>\n<li><code class=\"language-text\">svc</code>는 서비스를 뜻하며, 접근하고자 하는 리소스를 나타낸다.</li>\n<li><code class=\"language-text\">cluster.local</code>은 클러스터 내에서 사용 가능한 최상위 도메인이다.</li>\n</ul>\n<p>간단히 말하면, 접근하고자 하는 서비스의 이름과 네임스페이스만 안다면 이렇게 조합된 도메인을 통해 해당 서비스에 접근할 수 있게 된다.</p>\n<p>이번 포스팅에서는 이렇게 서비스 리소스의 등장 배경과, 서비스의 생성, 서비스에 대한 접근 방법에 대해 살펴보았다. 다음 포스팅에서는 ClusterIP, NodePort, LoadBalancer 타입의 서비스에 대해 상세히 알아볼 예정이다.</p>\n<hr>\n<h3 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h3>\n<ul>\n<li>[이미지 1] : <a href=\"https://microservices.io\">https://microservices.io</a></li>\n<li>[이미지 2-5] : M. Lukša, Kubernetes in Action, Manning Publications, 2018.</li>\n</ul>","frontmatter":{"title":"쿠버네티스 서비스 1 | 쿲벖넶팂슶 Ep.3","date":"July 26, 2021"}}},"pageContext":{"slug":"/cloud/service_1/","previous":{"fields":{"slug":"/cloud/modify_nodeport_range/"},"frontmatter":{"title":"쿠버네티스 NodePort 할당 범위 변경하기","category":"Cloud","draft":false}},"next":{"fields":{"slug":"/cloud/service_2/"},"frontmatter":{"title":"쿠버네티스 서비스 2 | 쿲벖넶팂슶 Ep.4","category":"Cloud","draft":false}}}},"staticQueryHashes":["3128451518","521680639"]}